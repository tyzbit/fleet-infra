apiVersion: batch/v1beta1
kind: CronJob
metadata:
  name: nextcloud-cron
  namespace: default
spec:
  successfulJobsHistoryLimit: 1
  schedule: "*/5 * * * *"
  jobTemplate:
    spec:
      activeDeadlineSeconds: 900
      backoffLimit: 2
      completions: 1
      parallelism: 1
      template:
        spec:
          containers:
          - name: nextcloud-cron
            # Same image as in /etc/kubernetes/manifests/etcd.yaml
            image: nextcloud:21.0.0
            imagePullPolicy: Always
            command: ["su", "-p", "www-data", "-s", "/bin/sh", "-c", "php -f /var/www/html/cron.php"]
            volumeMounts:
              - mountPath: "/var/www/html"
                name: nextcloud-data
            resources:
              requests:
                cpu: 200m
              limits:
                memory: 256Mi
          restartPolicy: Never
          volumes:
            - name: nextcloud-data
              persistentVolumeClaim:
                claimName: nextcloud-data
          imagePullSecrets:
            - name: docker-hub